!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(global,(()=>(()=>{"use strict";var t={226:function(t,e){var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function u(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.displayCursorContent=e.clearContentAtPositions=e.displayContentAtPositions=e.openNewWindow=e.openBrowserWindow=e.resizeImage=e.toBuffer=e.toBase64=e.getAreaBuffer=e.waitUntilMarked=e.clearAreas=e.markAreas=e.getWindowText=e.getMarkedText=e.stopAudioRecording=e.startAudioRecording=e.waitForInput=e.waitForConfirm=e.isStreaming=e.startStream=e.endStream=e.replaceContentStream=e.pushContentStream=e.pushLog=e.addResult=e.updatePrompt=e.addPrompt=e.executeCommand=e.getCommands=e.getAiApiKey=e.getAiSettings=e.getKeyValues=e.submitPrompt=e.setInput=e.addInteractionContent=e.getState=e.updateState=e.getInteractionState=e.newInteraction=e.getImagesByWindowName=e.getImagesBySimilarity=e.ingestImages=e.ingestText=e.getDocsByUrl=e.getDocsBySimilarity=e.getAllDocs=e.restoreApp=e.closeApp=e.openApp=e.codeExec=void 0,e.DefaultKeys=e.waitforAnswer=e.classifyText=e.taskExplainListener=e.taskMarkListener=e.stopTaskRecording=e.startTaskRecording=e.getTaskFlows=e.addNewTaskFlow=e.callRag=e.determineMatches=e.labelImage=e.getEmbedding=e.webResearch=e.extractYoutubeContent=e.extractTextFromImage=e.extractWebsiteContent=e.playAudio=e.hideCursorContent=void 0;const i="test",o="http://localhost:3440/execute";function r(t){return n(this,arguments,void 0,(function*(t,e=0){try{const e={code:t,key:i},n=yield fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return(yield n.json()).result}catch(n){if(console.log(n),3==++e)throw new Error(n);return r(t,e)}}))}function a(t){return n(this,arguments,void 0,(function*(t,e="code/exec"){try{const n=yield fetch(`http://localhost:3400/api/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return(yield n.json()).result}catch(t){throw console.log(t),new Error(t)}}))}function u(){return n(this,void 0,void 0,(function*(){return yield r("return await getKeyValues();")}))}function s(t){return n(this,void 0,void 0,(function*(){return(yield u()).find((e=>e.id===t))}))}function c(){return n(this,void 0,void 0,(function*(){return yield r("return await waitForInput();")}))}function d(t,e="png"){return`data:image/${e};base64,${t.toString("base64")}`}function l(t){return Buffer.from(t.replace(/^data:image\/\w+;base64,/,""),"base64")}function f(t,e,i){return n(this,void 0,void 0,(function*(){const n=`return await classifyText(\`${t}\`, ${JSON.stringify(e)}, ${i});`;return yield r(n)}))}function y(t){return t?("string"!=typeof t&&(t=JSON.stringify(t)),encodeURI(t)):""}function p(t){return t?("string"!=typeof t&&(t=t.toString()),t.replace(/`/g,"\\`")):""}var v;e.codeExec=r,e.openApp=function(t){return n(this,void 0,void 0,(function*(){const e=`return await openApp(${JSON.stringify(null!=t?t:{})});`;return yield r(e)}))},e.closeApp=function(){return n(this,void 0,void 0,(function*(){yield r("closeApp();")}))},e.restoreApp=function(){return n(this,void 0,void 0,(function*(){yield r("await restoreApp();")}))},e.getAllDocs=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getAllDocs();")}))},e.getDocsBySimilarity=function(t){return n(this,arguments,void 0,(function*(t,e=2,n={},i="global"){const o=`return await getDocsBySimilarity(\`${p(t)}\`, ${e}, ${JSON.stringify(n)}, '${i}');`;return yield r(o)}))},e.getDocsByUrl=function(t){return n(this,void 0,void 0,(function*(){const e=`return await getDocsByUrl('${t}');`;return yield r(e)}))},e.ingestText=function(t,e){return n(this,arguments,void 0,(function*(t,e,n="global"){const i=`await ingestText(\`${t}\`, ${JSON.stringify(null!=e?e:{})}, '${n}');`;yield r(i)}))},e.ingestImages=function(t,e){return n(this,arguments,void 0,(function*(t,e,n="images"){const i=`return await ingestImages(${JSON.stringify(t)}, ${JSON.stringify(null!=e?e:{})}, '${n}');`;return yield r(i)}))},e.getImagesBySimilarity=function(t){return n(this,arguments,void 0,(function*(t,e=2,n={},i="images"){"string"!=typeof t&&(t=d(t));const o=`return await getImagesBySimilarity(\`${t}\`, ${e}, ${JSON.stringify(n)}, '${i}');`;return yield r(o)}))},e.getImagesByWindowName=function(t){return n(this,void 0,void 0,(function*(){const e=`return await getImagesByWindowName('${t}');`;return yield r(e)}))},e.newInteraction=function(){return n(this,void 0,void 0,(function*(){return yield r("return await newInteraction();")}))},e.getInteractionState=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getInteractionState();")}))},e.updateState=function(t){return n(this,void 0,void 0,(function*(){const e=`updateState(${JSON.stringify(t)});`;yield r(e)}))},e.getState=function(){return n(this,void 0,void 0,(function*(){return yield r("return getState();")}))},e.addInteractionContent=function(t){return n(this,void 0,void 0,(function*(){const e=`await addInteractionContent(\`${t}\`);`;yield r(e)}))},e.setInput=function(t){return n(this,void 0,void 0,(function*(){const e=`await setInput(\`${t}\`);`;yield r(e)}))},e.submitPrompt=function(t){return n(this,void 0,void 0,(function*(){const e=`await submitPrompt(\`${t}\`);`;yield r(e)}))},e.getKeyValues=u,e.getAiSettings=s,e.getAiApiKey=function(t){return n(this,void 0,void 0,(function*(){return(yield s(t)).values.ApiKey}))},e.getCommands=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getCommands();")}))},e.executeCommand=function(t,e){return n(this,void 0,void 0,(function*(){const n=`return await execCommand(\`${t}\`, \`${e}\`);`;return yield r(n)}))},e.addPrompt=function(t){return n(this,void 0,void 0,(function*(){const e=`addPrompt(\`${y(t)}\`, true);`;yield r(e)}))},e.updatePrompt=function(t){return n(this,void 0,void 0,(function*(){const e=`updatePrompt(\`${y(t)}\`, true);`;yield r(e)}))},e.addResult=function(t){return n(this,void 0,void 0,(function*(){const e=`addResult(\`${y(t)}\`, null, true);`;yield r(e)}))},e.pushLog=function(t){return n(this,void 0,void 0,(function*(){const e=`pushLog(\`${y(t)}\`, true);`;yield r(e)}))},e.pushContentStream=function(t){return n(this,void 0,void 0,(function*(){const e=`pushContentStream(\`${y(t)}\`);`;yield r(e)}))},e.replaceContentStream=function(t,e){return n(this,void 0,void 0,(function*(){const n=`replaceContentStream(\`${y(t)}\`, \`${y(e)}\`);`;yield r(n)}))},e.endStream=function(){return n(this,void 0,void 0,(function*(){yield r("endStream();")}))},e.startStream=function(){return n(this,void 0,void 0,(function*(){yield r("await startStream();")}))},e.isStreaming=function(){return n(this,void 0,void 0,(function*(){return yield r("return await isStreaming();")}))},e.waitForConfirm=function(t,e){return n(this,void 0,void 0,(function*(){const n=`return await waitForConfirm(\`${p(t)}\`, ${JSON.stringify(e)});`;return yield r(n)}))},e.waitForInput=c,e.startAudioRecording=function(){return n(this,void 0,void 0,(function*(){const t=yield r("return await startAudioRecording();");return t?Buffer.from(JSON.parse(t)):null}))},e.stopAudioRecording=function(){return n(this,void 0,void 0,(function*(){yield r("stopAudioRecording();")}))},e.getMarkedText=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getMarkedText();")}))},e.getWindowText=function(){return n(this,arguments,void 0,(function*(t=!1){const e=`return await getWindowText(${t});`,n=yield r(e);return t?n?JSON.parse(n):null:n}))},e.markAreas=function(t){return n(this,void 0,void 0,(function*(){const e=`await markAreas(${JSON.stringify(t)});`;yield r(e)}))},e.clearAreas=function(){return n(this,void 0,void 0,(function*(){yield r("await clearAreas();")}))},e.waitUntilMarked=function(){return n(this,void 0,void 0,(function*(){const t=yield r("return await waitUntilMarked();");return{fileBuffer:Buffer.from(JSON.parse(t.fileBuffer)),captureRect:t.captureRect}}))},e.getAreaBuffer=function(t,e,i,o){return n(this,void 0,void 0,(function*(){const n=`return await getAreaBuffer(${t}, ${e}, ${i}, ${o});`,a=yield r(n);return Buffer.from(JSON.parse(a.fileBuffer))}))},e.toBase64=d,e.toBuffer=l,e.resizeImage=function(t,e,i){return n(this,arguments,void 0,(function*(t,e,n,i=!0){let o=t;const a="string"!=typeof t;a&&(o=d(t));const u=`return await resizeImage(\`${o}\`, ${e}, ${n});`;let s=yield r(u);return a&&i&&(s=l(s)),s}))},e.openBrowserWindow=function(t,e){return n(this,void 0,void 0,(function*(){const n=`await openBrowserWindow(\`${t}\`, ${JSON.stringify(null!=e?e:{})});`;yield r(n)}))},e.openNewWindow=function(t,e){return n(this,void 0,void 0,(function*(){const n=`await openExternalWindow(\`${y(t)}\`, ${JSON.stringify(null!=e?e:{})});`;yield r(n)}))},e.displayContentAtPositions=function(t){return n(this,arguments,void 0,(function*(t,e={clickable:!1,additionalCss:""}){const n=`await displayContentAtPositions(\`${y(t)}\`, \`${y(e)}\`);`;yield r(n)}))},e.clearContentAtPositions=function(){return n(this,void 0,void 0,(function*(){yield r("await clearContentAtPositions();")}))},e.displayCursorContent=function(t){return n(this,void 0,void 0,(function*(){const e=`await displayCursorContent(\`${t}\`);`;yield r(e)}))},e.hideCursorContent=function(){return n(this,void 0,void 0,(function*(){yield r("await hideCursorContent();")}))},e.playAudio=function(t,e){return n(this,void 0,void 0,(function*(){const n=`await playAudio(\`${t}\`, ${e});`;yield r(n)}))},e.extractWebsiteContent=function(t){return n(this,arguments,void 0,(function*(t,e=1){const n=`return await extractWebsiteContent(\`${t}\`, ${e}, true);`,i=yield a({code:n});return JSON.parse(i)}))},e.extractTextFromImage=function(t){return n(this,arguments,void 0,(function*(t,e="eng"){const n=`return await extractTextFromImage(\`${JSON.stringify(t)}\`, \`${e}\`, true);`,i=yield a({code:n});return JSON.parse(i)}))},e.extractYoutubeContent=function(t){return n(this,void 0,void 0,(function*(){const e=`return await extractYoutubeContent(\`${t}\`, true);`,n=yield r(e);return JSON.parse(n)}))},e.webResearch=function(t){return n(this,void 0,void 0,(function*(){const e=`return await webResearch(\`${t}\`, true);`,n=yield a({code:e});return n?JSON.parse(n):[]}))},e.getEmbedding=function(t,e){return n(this,void 0,void 0,(function*(){return yield a({texts:t,model:e},"vector/embedding")}))},e.labelImage=function(t){return n(this,void 0,void 0,(function*(){"string"!=typeof t&&(t=d(t));const e=`return await labelImage(\`${t}\`);`,n=yield r(e);return{img:Buffer.from(JSON.parse(n.imgBufferStr)),fields:n.fields}}))},e.determineMatches=function(t,e){return n(this,arguments,void 0,(function*(t,e,n=.8){const i=`return await determineMatches(\`${t}\`, \`${e}\`, ${n});`;return yield r(i)}))},e.callRag=function(t,e,i){return n(this,void 0,void 0,(function*(){const n=`return await callRag(\`${t}\`, ${JSON.stringify(e)}, ${JSON.stringify(i)});`;return yield r(n)}))},e.addNewTaskFlow=function(t){return n(this,void 0,void 0,(function*(){const e=`await addNewTaskFlow(${JSON.stringify(t)});`;yield r(e)}))},e.getTaskFlows=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getTaskFlows();")}))},e.startTaskRecording=function(){return n(this,void 0,void 0,(function*(){yield r("await startTaskRecording()")}))},e.stopTaskRecording=function(){return n(this,void 0,void 0,(function*(){yield r("stopTaskRecording()")}))},e.taskMarkListener=function(){return n(this,void 0,void 0,(function*(){return yield r("return await taskMarkListener()")}))},e.taskExplainListener=function(){return n(this,void 0,void 0,(function*(){return yield r("return await taskExplainListener()")}))},e.classifyText=f,e.waitforAnswer=function(t){return n(this,void 0,void 0,(function*(){const e=yield c(),n=yield f(e,t);return n.scores.indexOf(Math.max(...n.scores))}))},function(t){t.GOOGLE="GOOGLE",t.OPENAI="OPENAI"}(v||(e.DefaultKeys=v={}))},13:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function u(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.BaseSummarize2=void 0;const o=n(16),r=n(93),a=n(317);e.BaseSummarize2=class{constructor(t){this.llm=t}call(t,e,n,u){return i(this,void 0,void 0,(function*(){return new Promise(((n,s)=>i(this,void 0,void 0,(function*(){var i,c;try{let s=t;if("string"==typeof t){const e=new r.RecursiveCharacterTextSplitter({chunkSize:800});s=yield e.createDocuments([t])}const d=`Write a concise summary ${e?`and take ${e} into account`:""} of the following:\n\n\n                "{text}"\n                \n                \n                CONCISE SUMMARY:`,l=(0,o.loadSummarizationChain)(this.llm,{type:"refine",refinePrompt:new a.PromptTemplate({template:d,inputVariables:["text"]})}),f=yield l.invoke({input_documents:s},{callbacks:null==u?void 0:u.callbacks});n(null!==(c=null===(i=f.output_text)||void 0===i?void 0:i.trimStart())&&void 0!==c?c:"Nothing to summarize")}catch(t){s(t)}}))))}))}}},318:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function u(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.main=void 0;const o=n(88),r=n(226),a=n(13),u=n(317),s=n(724),c="Getting anything together <loading>";e.main=function(t,e){return i(this,void 0,void 0,(function*(){(yield(0,r.isStreaming)())||(yield(0,r.startStream)()),yield(0,r.pushContentStream)(c);const n=yield(0,r.getAiSettings)(e.defaultLLMendpointId),d=(0,o.getLLMModel)(n),l=yield function(t,e){return i(this,void 0,void 0,(function*(){const n=u.PromptTemplate.fromTemplate("Do not explain or else just extract the URL as string of a given text.\n\n    Text: tell me the xy of example.com\n    URL: example.com\n\n    Text: Why is this so uncool of https://shu.de\n    URL: https://shu.de\n\n    Text: {text}\n    URL:").pipe(e).pipe(new s.StringOutputParser);return yield n.invoke({text:t})}))}(t,d),f=yield(0,r.getDocsByUrl)(l),y=new a.BaseSummarize2(d),p=yield y.call(f);return yield(0,r.replaceContentStream)(c,p),yield(0,r.endStream)(),p}))}},88:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getLLMModel=void 0;const i=n(228),o=n(664),r=n(487),a={temperature:.1,streaming:!0};e.getLLMModel=function(t){const e=t.values.ApiKey,n=t.values.Model;let u;switch(t.id){case"OPENAI":u=new i.ChatOpenAI(Object.assign(Object.assign({},a),{openAIApiKey:e,verbose:!0,model:n}));break;case"GOOGLE":u=new o.ChatGoogleGenerativeAI(Object.assign(Object.assign({},a),{model:n,apiKey:e}));break;case"OLLAMA":const s=t.values.Url;u=new r.Ollama({baseUrl:s,model:n});break;default:throw new Error("Model not found")}return u}},487:t=>{t.exports=require("@langchain/community/llms/ollama")},724:t=>{t.exports=require("@langchain/core/output_parsers")},317:t=>{t.exports=require("@langchain/core/prompts")},664:t=>{t.exports=require("@langchain/google-genai")},228:t=>{t.exports=require("@langchain/openai")},16:t=>{t.exports=require("langchain/chains")},93:t=>{t.exports=require("langchain/text_splitter")}},e={};return function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}(318)})()));