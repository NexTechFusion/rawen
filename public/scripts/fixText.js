!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var i in n)("object"==typeof exports?exports:t)[i]=n[i]}}(global,(()=>(()=>{"use strict";var t={226:function(t,e){var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function u(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.displayCursorContent=e.clearContentAtPositions=e.displayContentAtPositions=e.openNewWindow=e.openBrowserWindow=e.resizeImage=e.toBuffer=e.toBase64=e.getAreaBuffer=e.waitUntilMarked=e.clearAreas=e.markAreas=e.getWindowText=e.getMarkedText=e.stopAudioRecording=e.startAudioRecording=e.waitForInput=e.waitForConfirm=e.isStreaming=e.startStream=e.endStream=e.replaceContentStream=e.pushContentStream=e.pushLog=e.addResult=e.updatePrompt=e.addPrompt=e.executeCommand=e.getCommands=e.getAiApiKey=e.getAiSettings=e.getKeyValues=e.submitPrompt=e.setInput=e.addInteractionContent=e.getState=e.updateState=e.getInteractionState=e.newInteraction=e.getImagesByWindowName=e.getImagesBySimilarity=e.ingestImages=e.ingestText=e.getDocsByUrl=e.getDocsBySimilarity=e.getAllDocs=e.restoreApp=e.closeApp=e.openApp=e.codeExec=void 0,e.DefaultKeys=e.waitforAnswer=e.classifyText=e.taskExplainListener=e.taskMarkListener=e.stopTaskRecording=e.startTaskRecording=e.getTaskFlows=e.addNewTaskFlow=e.callRag=e.determineMatches=e.labelImage=e.getEmbedding=e.webResearch=e.extractYoutubeContent=e.extractTextFromImage=e.extractWebsiteContent=e.playAudio=e.hideCursorContent=void 0;const i="test",o="http://localhost:3440/execute";function r(t){return n(this,arguments,void 0,(function*(t,e=0){try{const e={code:t,key:i},n=yield fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return(yield n.json()).result}catch(n){if(console.log(n),3==++e)throw new Error(n);return r(t,e)}}))}function a(t){return n(this,arguments,void 0,(function*(t,e="code/exec"){try{const n=yield fetch(`http://localhost:3400/api/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!n.ok)throw new Error(`HTTP error! Status: ${n.status}`);return(yield n.json()).result}catch(t){throw console.log(t),new Error(t)}}))}function u(){return n(this,void 0,void 0,(function*(){return yield r("return await getKeyValues();")}))}function s(t){return n(this,void 0,void 0,(function*(){return(yield u()).find((e=>e.id===t))}))}function d(){return n(this,void 0,void 0,(function*(){return yield r("return await waitForInput();")}))}function c(t,e="png"){return`data:image/${e};base64,${t.toString("base64")}`}function l(t){return Buffer.from(t.replace(/^data:image\/\w+;base64,/,""),"base64")}function f(t,e,i){return n(this,void 0,void 0,(function*(){const n=`return await classifyText(\`${t}\`, ${JSON.stringify(e)}, ${i});`;return yield r(n)}))}function p(t){return t?("string"!=typeof t&&(t=JSON.stringify(t)),encodeURI(t)):""}function y(t){return t?("string"!=typeof t&&(t=t.toString()),t.replace(/`/g,"\\`")):""}var v;e.codeExec=r,e.openApp=function(t){return n(this,void 0,void 0,(function*(){const e=`return await openApp(${JSON.stringify(null!=t?t:{})});`;return yield r(e)}))},e.closeApp=function(){return n(this,void 0,void 0,(function*(){yield r("closeApp();")}))},e.restoreApp=function(){return n(this,void 0,void 0,(function*(){yield r("await restoreApp();")}))},e.getAllDocs=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getAllDocs();")}))},e.getDocsBySimilarity=function(t){return n(this,arguments,void 0,(function*(t,e=2,n={},i="global"){const o=`return await getDocsBySimilarity(\`${y(t)}\`, ${e}, ${JSON.stringify(n)}, '${i}');`;return yield r(o)}))},e.getDocsByUrl=function(t){return n(this,void 0,void 0,(function*(){const e=`return await getDocsByUrl('${t}');`;return yield r(e)}))},e.ingestText=function(t,e){return n(this,arguments,void 0,(function*(t,e,n="global"){const i=`await ingestText(\`${t}\`, ${JSON.stringify(null!=e?e:{})}, '${n}');`;yield r(i)}))},e.ingestImages=function(t,e){return n(this,arguments,void 0,(function*(t,e,n="images"){const i=`return await ingestImages(${JSON.stringify(t)}, ${JSON.stringify(null!=e?e:{})}, '${n}');`;return yield r(i)}))},e.getImagesBySimilarity=function(t){return n(this,arguments,void 0,(function*(t,e=2,n={},i="images"){"string"!=typeof t&&(t=c(t));const o=`return await getImagesBySimilarity(\`${t}\`, ${e}, ${JSON.stringify(n)}, '${i}');`;return yield r(o)}))},e.getImagesByWindowName=function(t){return n(this,void 0,void 0,(function*(){const e=`return await getImagesByWindowName('${t}');`;return yield r(e)}))},e.newInteraction=function(){return n(this,void 0,void 0,(function*(){return yield r("return await newInteraction();")}))},e.getInteractionState=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getInteractionState();")}))},e.updateState=function(t){return n(this,void 0,void 0,(function*(){const e=`updateState(${JSON.stringify(t)});`;yield r(e)}))},e.getState=function(){return n(this,void 0,void 0,(function*(){return yield r("return getState();")}))},e.addInteractionContent=function(t){return n(this,void 0,void 0,(function*(){const e=`await addInteractionContent(\`${t}\`);`;yield r(e)}))},e.setInput=function(t){return n(this,void 0,void 0,(function*(){const e=`await setInput(\`${t}\`);`;yield r(e)}))},e.submitPrompt=function(t){return n(this,void 0,void 0,(function*(){const e=`await submitPrompt(\`${t}\`);`;yield r(e)}))},e.getKeyValues=u,e.getAiSettings=s,e.getAiApiKey=function(t){return n(this,void 0,void 0,(function*(){return(yield s(t)).values.ApiKey}))},e.getCommands=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getCommands();")}))},e.executeCommand=function(t,e){return n(this,void 0,void 0,(function*(){const n=`return await execCommand(\`${t}\`, \`${e}\`);`;return yield r(n)}))},e.addPrompt=function(t){return n(this,void 0,void 0,(function*(){const e=`addPrompt(\`${p(t)}\`, true);`;yield r(e)}))},e.updatePrompt=function(t){return n(this,void 0,void 0,(function*(){const e=`updatePrompt(\`${p(t)}\`, true);`;yield r(e)}))},e.addResult=function(t){return n(this,void 0,void 0,(function*(){const e=`addResult(\`${p(t)}\`, null, true);`;yield r(e)}))},e.pushLog=function(t){return n(this,void 0,void 0,(function*(){const e=`pushLog(\`${p(t)}\`, true);`;yield r(e)}))},e.pushContentStream=function(t){return n(this,void 0,void 0,(function*(){const e=`pushContentStream(\`${p(t)}\`);`;yield r(e)}))},e.replaceContentStream=function(t,e){return n(this,void 0,void 0,(function*(){const n=`replaceContentStream(\`${p(t)}\`, \`${p(e)}\`);`;yield r(n)}))},e.endStream=function(){return n(this,void 0,void 0,(function*(){yield r("endStream();")}))},e.startStream=function(){return n(this,void 0,void 0,(function*(){yield r("await startStream();")}))},e.isStreaming=function(){return n(this,void 0,void 0,(function*(){return yield r("return await isStreaming();")}))},e.waitForConfirm=function(t,e){return n(this,void 0,void 0,(function*(){const n=`return await waitForConfirm(\`${y(t)}\`, ${JSON.stringify(e)});`;return yield r(n)}))},e.waitForInput=d,e.startAudioRecording=function(){return n(this,void 0,void 0,(function*(){const t=yield r("return await startAudioRecording();");return t?Buffer.from(JSON.parse(t)):null}))},e.stopAudioRecording=function(){return n(this,void 0,void 0,(function*(){yield r("stopAudioRecording();")}))},e.getMarkedText=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getMarkedText();")}))},e.getWindowText=function(){return n(this,arguments,void 0,(function*(t=!1){const e=`return await getWindowText(${t});`,n=yield r(e);return t?n?JSON.parse(n):null:n}))},e.markAreas=function(t){return n(this,void 0,void 0,(function*(){const e=`await markAreas(${JSON.stringify(t)});`;yield r(e)}))},e.clearAreas=function(){return n(this,void 0,void 0,(function*(){yield r("await clearAreas();")}))},e.waitUntilMarked=function(){return n(this,void 0,void 0,(function*(){const t=yield r("return await waitUntilMarked();");return{fileBuffer:Buffer.from(JSON.parse(t.fileBuffer)),captureRect:t.captureRect}}))},e.getAreaBuffer=function(t,e,i,o){return n(this,void 0,void 0,(function*(){const n=`return await getAreaBuffer(${t}, ${e}, ${i}, ${o});`,a=yield r(n);return Buffer.from(JSON.parse(a.fileBuffer))}))},e.toBase64=c,e.toBuffer=l,e.resizeImage=function(t,e,i){return n(this,arguments,void 0,(function*(t,e,n,i=!0){let o=t;const a="string"!=typeof t;a&&(o=c(t));const u=`return await resizeImage(\`${o}\`, ${e}, ${n});`;let s=yield r(u);return a&&i&&(s=l(s)),s}))},e.openBrowserWindow=function(t,e){return n(this,void 0,void 0,(function*(){const n=`await openBrowserWindow(\`${t}\`, ${JSON.stringify(null!=e?e:{})});`;yield r(n)}))},e.openNewWindow=function(t,e){return n(this,void 0,void 0,(function*(){const n=`await openExternalWindow(\`${p(t)}\`, ${JSON.stringify(null!=e?e:{})});`;yield r(n)}))},e.displayContentAtPositions=function(t){return n(this,arguments,void 0,(function*(t,e={clickable:!1,additionalCss:""}){const n=`await displayContentAtPositions(\`${p(t)}\`, \`${p(e)}\`);`;yield r(n)}))},e.clearContentAtPositions=function(){return n(this,void 0,void 0,(function*(){yield r("await clearContentAtPositions();")}))},e.displayCursorContent=function(t){return n(this,void 0,void 0,(function*(){const e=`await displayCursorContent(\`${p(t)}\`, true);`;yield r(e)}))},e.hideCursorContent=function(){return n(this,void 0,void 0,(function*(){yield r("await hideCursorContent();")}))},e.playAudio=function(t,e){return n(this,void 0,void 0,(function*(){const n=`await playAudio(\`${t}\`, ${e});`;yield r(n)}))},e.extractWebsiteContent=function(t){return n(this,arguments,void 0,(function*(t,e=1){const n=`return await extractWebsiteContent(\`${t}\`, ${e}, true);`,i=yield a({code:n});return JSON.parse(i)}))},e.extractTextFromImage=function(t){return n(this,arguments,void 0,(function*(t,e="eng"){const n=`return await extractTextFromImage(\`${JSON.stringify(t)}\`, \`${e}\`, true);`,i=yield a({code:n});return JSON.parse(i)}))},e.extractYoutubeContent=function(t){return n(this,void 0,void 0,(function*(){const e=`return await extractYoutubeContent(\`${t}\`, true);`,n=yield r(e);return JSON.parse(n)}))},e.webResearch=function(t){return n(this,void 0,void 0,(function*(){const e=`return await webResearch(\`${t}\`, true);`,n=yield a({code:e});return n?JSON.parse(n):[]}))},e.getEmbedding=function(t,e){return n(this,void 0,void 0,(function*(){return yield a({texts:t,model:e},"vector/embedding")}))},e.labelImage=function(t){return n(this,void 0,void 0,(function*(){"string"!=typeof t&&(t=c(t));const e=`return await labelImage(\`${t}\`);`,n=yield r(e);return{img:Buffer.from(JSON.parse(n.imgBufferStr)),fields:n.fields}}))},e.determineMatches=function(t,e){return n(this,arguments,void 0,(function*(t,e,n=.8){const i=`return await determineMatches(\`${t}\`, \`${e}\`, ${n});`;return yield r(i)}))},e.callRag=function(t,e,i){return n(this,void 0,void 0,(function*(){const n=`return await callRag(\`${t}\`, ${JSON.stringify(e)}, ${JSON.stringify(i)});`;return yield r(n)}))},e.addNewTaskFlow=function(t){return n(this,void 0,void 0,(function*(){const e=`await addNewTaskFlow(${JSON.stringify(t)});`;yield r(e)}))},e.getTaskFlows=function(){return n(this,void 0,void 0,(function*(){return yield r("return await getTaskFlows();")}))},e.startTaskRecording=function(){return n(this,void 0,void 0,(function*(){yield r("await startTaskRecording()")}))},e.stopTaskRecording=function(){return n(this,void 0,void 0,(function*(){yield r("stopTaskRecording()")}))},e.taskMarkListener=function(){return n(this,void 0,void 0,(function*(){return yield r("return await taskMarkListener()")}))},e.taskExplainListener=function(){return n(this,void 0,void 0,(function*(){return yield r("return await taskExplainListener()")}))},e.classifyText=f,e.waitforAnswer=function(t){return n(this,void 0,void 0,(function*(){const e=yield d(),n=yield f(e,t);return n.scores.indexOf(Math.max(...n.scores))}))},function(t){t.GOOGLE="GOOGLE",t.OPENAI="OPENAI"}(v||(e.DefaultKeys=v={}))},974:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function u(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.addKeyboardListener=e.getMarkedText=e.pressCut=e.pressPaste=e.pressCopy=e.pressKey=e.pasteText=void 0;const r=o(n(435)),a=n(674),u=n(633);e.pasteText=function(t){return i(this,void 0,void 0,(function*(){yield a.clipboard.writeText(t),(0,e.pressPaste)()}))},e.pressKey=t=>{r.default.keyTap(t)},e.pressCopy=()=>i(void 0,void 0,void 0,(function*(){"darwin"===process.platform?r.default.keyTap("c","command"):r.default.keyTap("c","control"),yield new Promise((t=>setTimeout(t,500)))})),e.pressPaste=()=>i(void 0,void 0,void 0,(function*(){"darwin"===process.platform?r.default.keyTap("v","command"):r.default.keyTap("v","control")})),e.pressCut=()=>i(void 0,void 0,void 0,(function*(){"darwin"===process.platform?r.default.keyTap("x","command"):r.default.keyTap("x","control")})),e.getMarkedText=()=>i(void 0,void 0,void 0,(function*(){try{return yield(0,e.pressCopy)(),yield a.clipboard.readText()}catch(t){return console.error(t),""}})),e.addKeyboardListener=function(t){const e=new u.GlobalKeyboardListener;return e.addListener((e=>{"DOWN"!=e.state&&"UP"==e.state&&t(e)})),e}},72:function(t,e,n){var i=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function a(t){try{s(i.next(t))}catch(t){r(t)}}function u(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,u)}s((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.main=void 0;const o=n(88),r=n(226),a=n(724),u=n(317),s=n(974),d=n(521),c="LEFT CTRL";e.main=function(t,e){return i(this,void 0,void 0,(function*(){try{yield(0,r.displayCursorContent)('<div class="flex text-orange-300"> <i class="animate-spin w-5 h-5 mr-2" data-feather="aperture"></i>Checking...</div>');const n=d.windowManager.getActiveWindow();if(null==t||""==t.trim()){const e=yield(0,s.getMarkedText)();if(""==e)return void(yield(0,r.addResult)("No text provided"));t=e}const l=yield(0,r.getAiSettings)(e.defaultLLMendpointId),f=(0,o.getLLMModel)(l),p=u.ChatPromptTemplate.fromTemplate("Fix or enhance the provided text.\nOriginal Text: {text}\n\nRevised Text:").pipe(f).pipe(new a.StringOutputParser);let y=yield p.invoke({text:t});if(""===y||void 0===y)return void(yield(0,r.addResult)("No suggestion found"));y.includes("```")&&(y=function(t){const e=t.match(/```[a-z]*\n([\s\S]*?)```/i);return e?e[1].trim():t}(y)),yield(0,r.hideCursorContent)(),yield(0,r.displayCursorContent)('<div class="bg-white shadow-md rounded-lg p-2 opacity-85 max-w-md">\n        <div class="mb-4 text-gray-700">\n            {{text}}\n        </div>\n        <div class="flex justify-between">\n            <button class=" text-gray-800 font-bold py-2  text-xs px-4 rounded">\n                ESC - Cancel\n            </button>\n            <button class="text-blue-500 font-bold py-2 px-4 text-xs rounded flex small items-center">\n                CTRL <span class="mx-2">→</span>  Take suggestion\n            </button>\n        </div>\n    </div>'.replace("{{text}}",y)),(yield function(){return i(this,void 0,void 0,(function*(){return new Promise((t=>{const e=(0,s.addKeyboardListener)((n=>{n.name!=c&&"ESCAPE"!=n.name||(e.kill(),t(n.name))}))}))}))}())==c&&(n.bringToTop(),yield new Promise((t=>setTimeout(t,100))),yield(0,s.pasteText)(y))}catch(t){console.log("ERROR: ",t),yield(0,r.addResult)("An error occured")}finally{yield(0,r.hideCursorContent)()}}))}},88:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.getLLMModel=void 0;const i=n(228),o=n(664),r=n(487),a={temperature:.1,streaming:!0};e.getLLMModel=function(t){const e=t.values.ApiKey,n=t.values.Model;let u;switch(t.id){case"OPENAI":u=new i.ChatOpenAI(Object.assign(Object.assign({},a),{openAIApiKey:e,verbose:!0,model:n}));break;case"GOOGLE":u=new o.ChatGoogleGenerativeAI(Object.assign(Object.assign({},a),{model:n,apiKey:e}));break;case"OLLAMA":const s=t.values.Url;u=new r.Ollama({baseUrl:s,model:n});break;default:throw new Error("Model not found")}return u}},435:t=>{t.exports=require("@jitsi/robotjs")},487:t=>{t.exports=require("@langchain/community/llms/ollama")},724:t=>{t.exports=require("@langchain/core/output_parsers")},317:t=>{t.exports=require("@langchain/core/prompts")},664:t=>{t.exports=require("@langchain/google-genai")},228:t=>{t.exports=require("@langchain/openai")},674:t=>{t.exports=require("clipboard-sys")},633:t=>{t.exports=require("node-global-key-listener")},521:t=>{t.exports=require("node-window-manager")}},e={};return function n(i){var o=e[i];if(void 0!==o)return o.exports;var r=e[i]={exports:{}};return t[i].call(r.exports,r,r.exports,n),r.exports}(72)})()));